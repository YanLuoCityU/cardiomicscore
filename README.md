# CardiOmicScore: An AI-based multiomics profiling for personalized prediction of cardiovascular disease in the UK Biobank"

Code for the paper "CardiOmicScore: An AI-based multiomics profiling for personalized prediction of cardiovascular disease in the UK Biobank". This repository contains Python and R codes for data preprocessing, model training and evaluations, model interpretation, and visualization. Our demo website can be found [here](https://yanluocityu.github.io/cardiomicscore-website/).

## Project Structure and Usage Guidance

### 1. `config/`
This folder contains the parameter configurations used for fitting different deep learning models. The final parameters for each model are stored in a corresponding `final_param.json` file.

---
### 2. `data/`
This directory stores all data-related files.
- `data/processed/`: Contains processed intermediate files (e.g., omics data, covariates, outcomes) ready for the next steps.
- `data/split_seed-XXX/`: Contains the final training, validation, and test sets after preprocessing and imputation for different cohorts. These are the primary datasets used for model training.
- `data/split_seed_raw-250901/`: Contains dataset splits created from the raw data *without* missing value imputation or full preprocessing. This subset is specifically used for generating descriptive baseline characteristic tables.

---
### 3. `data_loader/`
This module contains all code for preparing input features and outcomes.
- `OmicsGenerator/`: Scripts for extracting and processing omics features (Metabolomics, Proteomics, PRS).
- `PredictorsGenerator/`: Scripts for generating clinical predictors.
- `OutcomesGenerator/`: Scripts for constructing the outcome variables.

---
### 4. `model/`
This directory contains all code related to model development, from hyperparameter tuning to final training and benchmarking.
- `hyperparameter_tuning/`: Scripts for deep learning hyperparameter tuning, primarily using Optuna to find the optimal architecture and parameters for the MetNet and ProNet.
- `training/`: After tuning, scripts in this folder use the optimal parameters to train the final deep learning models (MetNet and ProNet).
- `baseline/`: Contains implementations of various baseline models, including traditional clinical scores and standard machine learning algorithms (e.g., XGBoost, Random Forest), used for benchmarking.
- `coxph/`: Scripts to fit Cox Proportional-Hazards models to evaluate and compare the predictive performance of various combinations of multi-omics scores and clinical predictors.
- `fine_gray/`: As a sensitivity analysis, this contains scripts to fit Fine-Gray competing risk models to also compare the performance of various combinations of multi-omics scores and clinical predictors.

---
### 5. `analysis/`
This folder contains scripts for results integration and survival analysis. It processes the outputs generated by the models to produce summary statistics, comparison metrics, and data for final visualizations.

---
### 6. `saved/`
This directory is the central location for all outputs generated during the project lifecycle.
- `log/`: Contains various log files from data processing, model training, and analysis runs for debugging and tracking experiments.
- `models/`: Stores the final, trained model objects.
- `results/`: Stores all intermediate results generated during analysis, such as prediction scores, SHAP values, and performance metrics (`C-index`, etc.).

---
### 7. `visualization/`
This directory contains the master R Markdown script (`visualization.Rmd`) responsible for generating **all manuscript-ready tables and figures**. It reads the summary data from `saved/results/` and produces the final outputs in `results/Figure/` and `results/Table/`.

Key visualizations and tables generated by this script include:
- **Descriptive Statistics**: Baseline characteristics tables.
- **Cohort Characteristics**: Plots of follow-up time and incident cases across datasets.
- **Survival Analysis Plots**: Kaplan-Meier curves and Hazard Ratio forest plots.
- **Model Performance Plots**: A comprehensive set of C-index and Î” C-index forest plots for main analysis, geographic validation, single- vs. multi-omics comparisons, and all subgroup/sensitivity analyses.
- **Model Interpretation Plots**: SHAP heatmaps and detailed beeswarm plots to visualize feature importance.

---

## System requirements
All codes were originally processed using:

- **System hardware**:
  - Python version 3.8.5, Linux
  - R version 4.3.3, Windows 10 x64

- **Main Python software**:
  - `scikit-learn` v1.3.2
  - `pytorch` v1.11.0 (CUDA 11.3, cuDNN 8.2.0)
  - `optuna` v4.0.0
  - `shap` v0.46.0
  - `lifelines` v0.27.8
  - `xgboost` v2.0.3
  - `lightgbm` v4.4.0

- **Main R software**:
  - `tidyverse` v2.0.0
  - `dplyr` v1.1.4
  - `data.table` v1.17.0
  - `stringr` v1.5.1
  - `arrow` v17.0.0.1
  - `gtsummary` v2.3.0
  - `flextable` v0.9.9
  - `skimr` v2.1.5
  - `janitor` v2.2.1
  - `ggplot2` v3.5.2
  - `patchwork` v1.3.1
  - `ggsci` v3.2.0
  - `ggtext` v0.1.2
  - `geomtextpath` v0.1.5
  - `MetBrewer` v0.2.0
  - `showtext` v0.9-7
  - `survival` v3.8-3
  - `cmprsk` v2.2-12
  - `dcurves` v0.5.0
  - `pracma` v2.4.4
  - `foreach` v1.5.2
  - `doParallel` v1.0.17
  - `futile.logger` v1.4.3

## License
This project is available under the MIT license.

## Contact
Yan Luo - luo.yan@my.cityu.edu.hk